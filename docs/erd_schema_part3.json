{
  "collections_final": {
    "workflows": {
      "description": "Workflow definitions and approval processes",
      "fields": {
        "_id": {"type": "string", "primary_key": true},
        "tenant_id": {"type": "string", "required": true, "foreign_key": "tenants._id"},
        "name": {"type": "string", "required": true, "max_length": 200},
        "description": {"type": "string"},
        "workflow_type": {"type": "enum", "values": ["approval", "notification", "automation", "escalation"], "required": true},
        "entity_type": {"type": "string", "required": true, "description": "Entity this workflow applies to"},
        "trigger_event": {"type": "enum", "values": ["create", "update", "delete", "status_change", "time_based", "manual"], "required": true},
        "trigger_conditions": {"type": "object", "description": "Conditions that must be met"},
        "steps": {"type": "array", "items": {"type": "object"}, "description": "Workflow step definitions"},
        "parallel_execution": {"type": "boolean", "default": false},
        "timeout_hours": {"type": "integer", "default": 24},
        "escalation_rules": {"type": "array", "items": {"type": "object"}},
        "notification_rules": {"type": "array", "items": {"type": "object"}},
        "status": {"type": "enum", "values": ["draft", "active", "inactive", "archived"], "default": "draft"},
        "version": {"type": "integer", "default": 1},
        "is_system_workflow": {"type": "boolean", "default": false},
        "metadata": {"type": "object"},
        "is_active": {"type": "boolean", "default": true},
        "created_at": {"type": "datetime", "required": true},
        "updated_at": {"type": "datetime", "required": true},
        "created_by": {"type": "string", "foreign_key": "users._id"},
        "updated_by": {"type": "string", "foreign_key": "users._id"}
      },
      "indexes": [
        {"fields": ["tenant_id", "entity_type"]},
        {"fields": ["tenant_id", "workflow_type"]},
        {"fields": ["tenant_id", "status"]},
        {"fields": ["created_at"]}
      ]
    },
    "workflow_instances": {
      "description": "Active workflow executions and their state",
      "fields": {
        "_id": {"type": "string", "primary_key": true},
        "tenant_id": {"type": "string", "required": true, "foreign_key": "tenants._id"},
        "workflow_id": {"type": "string", "required": true, "foreign_key": "workflows._id"},
        "entity_type": {"type": "string", "required": true},
        "entity_id": {"type": "string", "required": true},
        "initiated_by": {"type": "string", "required": true, "foreign_key": "users._id"},
        "current_step": {"type": "integer", "default": 0},
        "status": {"type": "enum", "values": ["pending", "in_progress", "completed", "cancelled", "failed", "timeout"], "default": "pending"},
        "priority": {"type": "enum", "values": ["low", "medium", "high", "urgent"], "default": "medium"},
        "due_date": {"type": "datetime"},
        "completed_steps": {"type": "array", "items": {"type": "object"}},
        "pending_approvals": {"type": "array", "items": {"type": "object"}},
        "escalations": {"type": "array", "items": {"type": "object"}},
        "notifications_sent": {"type": "array", "items": {"type": "object"}},
        "data_context": {"type": "object", "description": "Workflow execution context"},
        "error_message": {"type": "string"},
        "completion_notes": {"type": "string"},
        "started_at": {"type": "datetime", "required": true},
        "completed_at": {"type": "datetime"},
        "metadata": {"type": "object"},
        "created_at": {"type": "datetime", "required": true},
        "updated_at": {"type": "datetime", "required": true}
      },
      "indexes": [
        {"fields": ["tenant_id", "workflow_id"]},
        {"fields": ["tenant_id", "entity_type", "entity_id"]},
        {"fields": ["tenant_id", "status"]},
        {"fields": ["tenant_id", "initiated_by"]},
        {"fields": ["due_date"]},
        {"fields": ["started_at"]}
      ]
    },
    "notifications": {
      "description": "System notifications and alerts",
      "fields": {
        "_id": {"type": "string", "primary_key": true},
        "tenant_id": {"type": "string", "required": true, "foreign_key": "tenants._id"},
        "recipient_id": {"type": "string", "required": true, "foreign_key": "users._id"},
        "sender_id": {"type": "string", "foreign_key": "users._id"},
        "notification_type": {"type": "enum", "values": ["system", "workflow", "reminder", "alert", "approval_request", "status_update"], "required": true},
        "title": {"type": "string", "required": true, "max_length": 200},
        "message": {"type": "string", "required": true},
        "priority": {"type": "enum", "values": ["low", "medium", "high", "urgent"], "default": "medium"},
        "category": {"type": "string", "description": "Notification category for filtering"},
        "entity_type": {"type": "string", "description": "Related entity type"},
        "entity_id": {"type": "string", "description": "Related entity ID"},
        "action_required": {"type": "boolean", "default": false},
        "action_url": {"type": "string", "description": "URL for required action"},
        "channels": {"type": "array", "items": {"type": "string"}, "description": "Delivery channels: email, sms, push, in_app"},
        "delivery_status": {"type": "object", "description": "Delivery status per channel"},
        "read": {"type": "boolean", "default": false},
        "read_at": {"type": "datetime"},
        "expires_at": {"type": "datetime"},
        "metadata": {"type": "object"},
        "created_at": {"type": "datetime", "required": true},
        "updated_at": {"type": "datetime", "required": true}
      },
      "indexes": [
        {"fields": ["tenant_id", "recipient_id", "read"]},
        {"fields": ["tenant_id", "notification_type"]},
        {"fields": ["tenant_id", "priority"]},
        {"fields": ["tenant_id", "entity_type", "entity_id"]},
        {"fields": ["expires_at"]},
        {"fields": ["created_at"]}
      ]
    },
    "integrations": {
      "description": "Third-party system integrations and configurations",
      "fields": {
        "_id": {"type": "string", "primary_key": true},
        "tenant_id": {"type": "string", "required": true, "foreign_key": "tenants._id"},
        "name": {"type": "string", "required": true, "max_length": 200},
        "integration_type": {"type": "enum", "values": ["sso", "scim", "webhook", "api", "file_sync", "email", "calendar"], "required": true},
        "provider": {"type": "string", "required": true, "description": "Integration provider (azure_ad, okta, jira, etc.)"},
        "status": {"type": "enum", "values": ["draft", "active", "inactive", "error"], "default": "draft"},
        "configuration": {"type": "object", "description": "Provider-specific configuration"},
        "credentials": {"type": "object", "description": "Encrypted credentials"},
        "sync_enabled": {"type": "boolean", "default": false},
        "sync_frequency": {"type": "string", "description": "Cron expression for sync frequency"},
        "last_sync_at": {"type": "datetime"},
        "last_sync_status": {"type": "enum", "values": ["success", "error", "partial"]},
        "last_sync_message": {"type": "string"},
        "error_count": {"type": "integer", "default": 0},
        "webhook_url": {"type": "string"},
        "webhook_secret": {"type": "string"},
        "supported_events": {"type": "array", "items": {"type": "string"}},
        "field_mapping": {"type": "object", "description": "Field mapping for data sync"},
        "metadata": {"type": "object"},
        "is_active": {"type": "boolean", "default": true},
        "created_at": {"type": "datetime", "required": true},
        "updated_at": {"type": "datetime", "required": true},
        "created_by": {"type": "string", "foreign_key": "users._id"},
        "updated_by": {"type": "string", "foreign_key": "users._id"}
      },
      "indexes": [
        {"fields": ["tenant_id", "integration_type"]},
        {"fields": ["tenant_id", "provider"]},
        {"fields": ["tenant_id", "status"]},
        {"fields": ["webhook_url"]},
        {"fields": ["created_at"]}
      ]
    },
    "reports": {
      "description": "Custom reports and dashboard definitions",
      "fields": {
        "_id": {"type": "string", "primary_key": true},
        "tenant_id": {"type": "string", "required": true, "foreign_key": "tenants._id"},
        "name": {"type": "string", "required": true, "max_length": 200},
        "description": {"type": "string"},
        "report_type": {"type": "enum", "values": ["dashboard", "report", "chart", "table", "export"], "required": true},
        "category": {"type": "string", "description": "Report category for organization"},
        "data_source": {"type": "string", "description": "Primary data source"},
        "query_definition": {"type": "object", "description": "Query/filter definitions"},
        "visualization_config": {"type": "object", "description": "Chart/visualization settings"},
        "parameters": {"type": "array", "items": {"type": "object"}, "description": "Report parameters"},
        "schedule": {"type": "object", "description": "Automated report generation schedule"},
        "output_format": {"type": "array", "items": {"type": "string"}, "description": "Supported output formats"},
        "access_level": {"type": "enum", "values": ["private", "team", "department", "organization", "tenant"], "default": "private"},
        "shared_with": {"type": "array", "items": {"type": "string", "foreign_key": "users._id"}},
        "is_system_report": {"type": "boolean", "default": false},
        "is_template": {"type": "boolean", "default": false},
        "usage_count": {"type": "integer", "default": 0},
        "last_generated": {"type": "datetime"},
        "metadata": {"type": "object"},
        "is_active": {"type": "boolean", "default": true},
        "created_at": {"type": "datetime", "required": true},
        "updated_at": {"type": "datetime", "required": true},
        "created_by": {"type": "string", "foreign_key": "users._id"},
        "updated_by": {"type": "string", "foreign_key": "users._id"}
      },
      "indexes": [
        {"fields": ["tenant_id", "report_type"]},
        {"fields": ["tenant_id", "created_by"]},
        {"fields": ["tenant_id", "category"]},
        {"fields": ["tenant_id", "is_system_report"]},
        {"fields": ["created_at"]}
      ]
    },
    "dashboard_widgets": {
      "description": "Dashboard widget instances and configurations",
      "fields": {
        "_id": {"type": "string", "primary_key": true},
        "tenant_id": {"type": "string", "required": true, "foreign_key": "tenants._id"},
        "dashboard_id": {"type": "string", "foreign_key": "reports._id"},
        "user_id": {"type": "string", "foreign_key": "users._id"},
        "widget_type": {"type": "enum", "values": ["chart", "table", "metric", "list", "calendar", "custom"], "required": true},
        "title": {"type": "string", "required": true, "max_length": 200},
        "position": {"type": "object", "description": "Widget position and size"},
        "data_source": {"type": "string", "required": true},
        "query_config": {"type": "object", "description": "Widget-specific query configuration"},
        "visualization_config": {"type": "object", "description": "Visualization settings"},
        "refresh_interval": {"type": "integer", "description": "Auto-refresh interval in seconds"},
        "cache_duration": {"type": "integer", "description": "Cache duration in seconds"},
        "filters": {"type": "object", "description": "Applied filters"},
        "drill_down_config": {"type": "object", "description": "Drill-down navigation settings"},
        "permissions": {"type": "array", "items": {"type": "string"}},
        "last_updated": {"type": "datetime"},
        "metadata": {"type": "object"},
        "is_active": {"type": "boolean", "default": true},
        "created_at": {"type": "datetime", "required": true},
        "updated_at": {"type": "datetime", "required": true},
        "created_by": {"type": "string", "foreign_key": "users._id"},
        "updated_by": {"type": "string", "foreign_key": "users._id"}
      },
      "indexes": [
        {"fields": ["tenant_id", "dashboard_id"]},
        {"fields": ["tenant_id", "user_id"]},
        {"fields": ["tenant_id", "widget_type"]},
        {"fields": ["created_at"]}
      ]
    }
  },
  "relationships": {
    "tenant_to_organizations": {"type": "one_to_many", "parent": "tenants", "child": "organizations"},
    "tenant_to_users": {"type": "one_to_many", "parent": "tenants", "child": "users"},
    "tenant_to_portfolios": {"type": "one_to_many", "parent": "tenants", "child": "portfolios"},
    "tenant_to_projects": {"type": "one_to_many", "parent": "tenants", "child": "projects"},
    "organization_to_users": {"type": "one_to_many", "parent": "organizations", "child": "users"},
    "organization_to_portfolios": {"type": "one_to_many", "parent": "organizations", "child": "portfolios"},
    "organization_hierarchy": {"type": "self_referential", "table": "organizations", "parent_field": "parent_org_id"},
    "portfolio_to_projects": {"type": "one_to_many", "parent": "portfolios", "child": "projects"},
    "project_to_tasks": {"type": "one_to_many", "parent": "projects", "child": "tasks"},
    "project_hierarchy": {"type": "self_referential", "table": "projects", "parent_field": "parent_project_id"},
    "task_hierarchy": {"type": "self_referential", "table": "tasks", "parent_field": "parent_task_id"},
    "user_to_assignments": {"type": "one_to_many", "parent": "users", "child": "assignments"},
    "task_to_assignments": {"type": "one_to_many", "parent": "tasks", "child": "assignments"},
    "user_to_timesheets": {"type": "one_to_many", "parent": "users", "child": "timesheets"},
    "project_to_timesheets": {"type": "one_to_many", "parent": "projects", "child": "timesheets"},
    "task_to_timesheets": {"type": "one_to_many", "parent": "tasks", "child": "timesheets"},
    "project_to_budgets": {"type": "one_to_many", "parent": "projects", "child": "budgets"},
    "portfolio_to_budgets": {"type": "one_to_many", "parent": "portfolios", "child": "budgets"},
    "budget_to_costs": {"type": "one_to_many", "parent": "budgets", "child": "costs"},
    "project_to_costs": {"type": "one_to_many", "parent": "projects", "child": "costs"},
    "project_to_risks": {"type": "one_to_many", "parent": "projects", "child": "risks"},
    "portfolio_to_risks": {"type": "one_to_many", "parent": "portfolios", "child": "risks"},
    "attachment_versioning": {"type": "self_referential", "table": "attachments", "parent_field": "parent_attachment_id"},
    "user_management_hierarchy": {"type": "self_referential", "table": "users", "parent_field": "manager_id"},
    "workflow_to_instances": {"type": "one_to_many", "parent": "workflows", "child": "workflow_instances"},
    "user_to_notifications": {"type": "one_to_many", "parent": "users", "child": "notifications"},
    "tenant_to_integrations": {"type": "one_to_many", "parent": "tenants", "child": "integrations"},
    "user_to_reports": {"type": "one_to_many", "parent": "users", "child": "reports"},
    "report_to_widgets": {"type": "one_to_many", "parent": "reports", "child": "dashboard_widgets"}
  }
}