{
  "collections_continued": {
    "timesheets": {
      "description": "Time tracking entries with approval workflow",
      "fields": {
        "_id": {"type": "string", "primary_key": true},
        "tenant_id": {"type": "string", "required": true, "foreign_key": "tenants._id"},
        "user_id": {"type": "string", "required": true, "foreign_key": "users._id"},
        "project_id": {"type": "string", "foreign_key": "projects._id"},
        "task_id": {"type": "string", "foreign_key": "tasks._id"},
        "date": {"type": "date", "required": true},
        "start_time": {"type": "time"},
        "end_time": {"type": "time"},
        "hours": {"type": "number", "required": true, "min": 0},
        "overtime_hours": {"type": "number", "default": 0},
        "description": {"type": "string"},
        "activity_type": {"type": "enum", "values": ["development", "testing", "documentation", "meeting", "research", "administration", "other"], "default": "development"},
        "status": {"type": "enum", "values": ["draft", "submitted", "approved", "rejected", "locked"], "default": "draft"},
        "billable": {"type": "boolean", "default": true},
        "hourly_rate": {"type": "decimal"},
        "cost": {"type": "decimal", "description": "Calculated cost (hours * rate)"},
        "approver_id": {"type": "string", "foreign_key": "users._id"},
        "approved_at": {"type": "datetime"},
        "approval_notes": {"type": "string"},
        "period_start": {"type": "date", "description": "Pay period start"},
        "period_end": {"type": "date", "description": "Pay period end"},
        "metadata": {"type": "object"},
        "is_active": {"type": "boolean", "default": true},
        "created_at": {"type": "datetime", "required": true},
        "updated_at": {"type": "datetime", "required": true},
        "created_by": {"type": "string", "foreign_key": "users._id"},
        "updated_by": {"type": "string", "foreign_key": "users._id"}
      },
      "indexes": [
        {"fields": ["tenant_id", "user_id", "date"]},
        {"fields": ["tenant_id", "project_id"]},
        {"fields": ["tenant_id", "task_id"]},
        {"fields": ["tenant_id", "status"]},
        {"fields": ["tenant_id", "approver_id"]},
        {"fields": ["period_start", "period_end"]},
        {"fields": ["created_at"]}
      ]
    },
    "budgets": {
      "description": "Budget allocations and tracking for projects and portfolios",
      "fields": {
        "_id": {"type": "string", "primary_key": true},
        "tenant_id": {"type": "string", "required": true, "foreign_key": "tenants._id"},
        "org_id": {"type": "string", "foreign_key": "organizations._id"},
        "portfolio_id": {"type": "string", "foreign_key": "portfolios._id"},
        "project_id": {"type": "string", "foreign_key": "projects._id"},
        "name": {"type": "string", "required": true, "max_length": 200},
        "description": {"type": "string"},
        "budget_type": {"type": "enum", "values": ["capex", "opex", "labor", "material", "vendor", "other"], "required": true},
        "status": {"type": "enum", "values": ["draft", "approved", "active", "closed", "cancelled"], "default": "draft"},
        "fiscal_year": {"type": "integer", "required": true},
        "budget_period": {"type": "enum", "values": ["annual", "quarterly", "monthly"], "default": "annual"},
        "currency": {"type": "string", "default": "USD"},
        "total_amount": {"type": "decimal", "required": true},
        "allocated_amount": {"type": "decimal", "default": 0},
        "committed_amount": {"type": "decimal", "default": 0},
        "spent_amount": {"type": "decimal", "default": 0},
        "remaining_amount": {"type": "decimal", "description": "Calculated field"},
        "variance_amount": {"type": "decimal", "description": "Budget vs actual variance"},
        "variance_percentage": {"type": "number", "description": "Variance as percentage"},
        "approval_required": {"type": "boolean", "default": false},
        "approver_id": {"type": "string", "foreign_key": "users._id"},
        "approved_at": {"type": "datetime"},
        "approval_notes": {"type": "string"},
        "budget_manager_id": {"type": "string", "foreign_key": "users._id"},
        "cost_center": {"type": "string"},
        "gl_account": {"type": "string", "description": "General ledger account code"},
        "start_date": {"type": "date"},
        "end_date": {"type": "date"},
        "metadata": {"type": "object"},
        "is_active": {"type": "boolean", "default": true},
        "created_at": {"type": "datetime", "required": true},
        "updated_at": {"type": "datetime", "required": true},
        "created_by": {"type": "string", "foreign_key": "users._id"},
        "updated_by": {"type": "string", "foreign_key": "users._id"}
      },
      "indexes": [
        {"fields": ["tenant_id", "fiscal_year"]},
        {"fields": ["tenant_id", "project_id"]},
        {"fields": ["tenant_id", "portfolio_id"]},
        {"fields": ["tenant_id", "status"]},
        {"fields": ["tenant_id", "budget_manager_id"]},
        {"fields": ["cost_center"]},
        {"fields": ["created_at"]}
      ]
    },
    "costs": {
      "description": "Actual cost entries and expense tracking",
      "fields": {
        "_id": {"type": "string", "primary_key": true},
        "tenant_id": {"type": "string", "required": true, "foreign_key": "tenants._id"},
        "budget_id": {"type": "string", "foreign_key": "budgets._id"},
        "project_id": {"type": "string", "foreign_key": "projects._id"},
        "task_id": {"type": "string", "foreign_key": "tasks._id"},
        "user_id": {"type": "string", "foreign_key": "users._id"},
        "timesheet_id": {"type": "string", "foreign_key": "timesheets._id"},
        "name": {"type": "string", "required": true, "max_length": 200},
        "description": {"type": "string"},
        "cost_type": {"type": "enum", "values": ["labor", "material", "vendor", "travel", "equipment", "software", "other"], "required": true},
        "cost_category": {"type": "string", "description": "Custom cost category"},
        "amount": {"type": "decimal", "required": true},
        "currency": {"type": "string", "default": "USD"},
        "quantity": {"type": "number", "default": 1},
        "unit_cost": {"type": "decimal"},
        "unit_type": {"type": "string", "description": "hours, items, licenses, etc."},
        "vendor_name": {"type": "string"},
        "invoice_number": {"type": "string"},
        "receipt_url": {"type": "string"},
        "cost_date": {"type": "date", "required": true},
        "period_start": {"type": "date"},
        "period_end": {"type": "date"},
        "status": {"type": "enum", "values": ["draft", "submitted", "approved", "rejected", "paid"], "default": "draft"},
        "approver_id": {"type": "string", "foreign_key": "users._id"},
        "approved_at": {"type": "datetime"},
        "approval_notes": {"type": "string"},
        "billable": {"type": "boolean", "default": false},
        "reimbursable": {"type": "boolean", "default": false},
        "cost_center": {"type": "string"},
        "gl_account": {"type": "string"},
        "purchase_order": {"type": "string"},
        "tags": {"type": "array", "items": {"type": "string"}},
        "metadata": {"type": "object"},
        "is_active": {"type": "boolean", "default": true},
        "created_at": {"type": "datetime", "required": true},
        "updated_at": {"type": "datetime", "required": true},
        "created_by": {"type": "string", "foreign_key": "users._id"},
        "updated_by": {"type": "string", "foreign_key": "users._id"}
      },
      "indexes": [
        {"fields": ["tenant_id", "cost_date"]},
        {"fields": ["tenant_id", "project_id"]},
        {"fields": ["tenant_id", "budget_id"]},
        {"fields": ["tenant_id", "user_id"]},
        {"fields": ["tenant_id", "status"]},
        {"fields": ["tenant_id", "cost_type"]},
        {"fields": ["cost_center"]},
        {"fields": ["created_at"]}
      ]
    },
    "risks": {
      "description": "Risk and issue management (RAID logs)",
      "fields": {
        "_id": {"type": "string", "primary_key": true},
        "tenant_id": {"type": "string", "required": true, "foreign_key": "tenants._id"},
        "portfolio_id": {"type": "string", "foreign_key": "portfolios._id"},
        "project_id": {"type": "string", "foreign_key": "projects._id"},
        "name": {"type": "string", "required": true, "max_length": 200},
        "description": {"type": "string", "required": true},
        "risk_type": {"type": "enum", "values": ["risk", "issue", "assumption", "dependency"], "required": true},
        "category": {"type": "enum", "values": ["technical", "business", "operational", "financial", "legal", "resource", "schedule", "quality", "external"], "required": true},
        "status": {"type": "enum", "values": ["open", "in_progress", "closed", "cancelled"], "default": "open"},
        "priority": {"type": "enum", "values": ["low", "medium", "high", "critical"], "default": "medium"},
        "probability": {"type": "enum", "values": ["very_low", "low", "medium", "high", "very_high"], "description": "For risks only"},
        "impact": {"type": "enum", "values": ["very_low", "low", "medium", "high", "very_high"], "required": true},
        "risk_score": {"type": "number", "description": "Calculated probability x impact"},
        "owner_id": {"type": "string", "required": true, "foreign_key": "users._id"},
        "assignee_id": {"type": "string", "foreign_key": "users._id"},
        "identified_date": {"type": "date", "required": true},
        "target_date": {"type": "date"},
        "actual_date": {"type": "date"},
        "mitigation_plan": {"type": "string"},
        "contingency_plan": {"type": "string"},
        "response_strategy": {"type": "enum", "values": ["avoid", "mitigate", "transfer", "accept", "exploit", "enhance", "share"]},
        "cost_impact": {"type": "decimal", "default": 0},
        "schedule_impact_days": {"type": "integer", "default": 0},
        "escalated": {"type": "boolean", "default": false},
        "escalated_to": {"type": "string", "foreign_key": "users._id"},
        "escalated_at": {"type": "datetime"},
        "resolution_notes": {"type": "string"},
        "lessons_learned": {"type": "string"},
        "tags": {"type": "array", "items": {"type": "string"}},
        "metadata": {"type": "object"},
        "is_active": {"type": "boolean", "default": true},
        "created_at": {"type": "datetime", "required": true},
        "updated_at": {"type": "datetime", "required": true},
        "created_by": {"type": "string", "foreign_key": "users._id"},
        "updated_by": {"type": "string", "foreign_key": "users._id"}
      },
      "indexes": [
        {"fields": ["tenant_id", "project_id"]},
        {"fields": ["tenant_id", "portfolio_id"]},
        {"fields": ["tenant_id", "risk_type"]},
        {"fields": ["tenant_id", "status"]},
        {"fields": ["tenant_id", "priority"]},
        {"fields": ["tenant_id", "owner_id"]},
        {"fields": ["tenant_id", "target_date"]},
        {"fields": ["created_at"]}
      ]
    },
    "attachments": {
      "description": "File attachments and document management",
      "fields": {
        "_id": {"type": "string", "primary_key": true},
        "tenant_id": {"type": "string", "required": true, "foreign_key": "tenants._id"},
        "entity_type": {"type": "enum", "values": ["portfolio", "project", "task", "risk", "timesheet", "cost", "user"], "required": true},
        "entity_id": {"type": "string", "required": true, "description": "ID of the related entity"},
        "filename": {"type": "string", "required": true, "max_length": 255},
        "original_filename": {"type": "string", "required": true},
        "file_path": {"type": "string", "required": true},
        "file_size": {"type": "integer", "required": true},
        "mime_type": {"type": "string", "required": true},
        "file_hash": {"type": "string", "description": "SHA256 hash for deduplication"},
        "version": {"type": "integer", "default": 1},
        "is_latest_version": {"type": "boolean", "default": true},
        "parent_attachment_id": {"type": "string", "foreign_key": "attachments._id", "description": "For versioning"},
        "description": {"type": "string"},
        "category": {"type": "string", "description": "Document category"},
        "visibility": {"type": "enum", "values": ["private", "team", "project", "portfolio", "public"], "default": "team"},
        "download_count": {"type": "integer", "default": 0},
        "last_accessed": {"type": "datetime"},
        "expires_at": {"type": "datetime", "description": "For temporary files"},
        "virus_scanned": {"type": "boolean", "default": false},
        "scan_result": {"type": "enum", "values": ["clean", "infected", "pending"], "default": "pending"},
        "tags": {"type": "array", "items": {"type": "string"}},
        "metadata": {"type": "object"},
        "is_active": {"type": "boolean", "default": true},
        "created_at": {"type": "datetime", "required": true},
        "updated_at": {"type": "datetime", "required": true},
        "created_by": {"type": "string", "foreign_key": "users._id"},
        "updated_by": {"type": "string", "foreign_key": "users._id"}
      },
      "indexes": [
        {"fields": ["tenant_id", "entity_type", "entity_id"]},
        {"fields": ["tenant_id", "created_by"]},
        {"fields": ["file_hash"]},
        {"fields": ["parent_attachment_id"]},
        {"fields": ["expires_at"]},
        {"fields": ["created_at"]}
      ]
    },
    "audit_logs": {
      "description": "Comprehensive audit trail for all system activities",
      "fields": {
        "_id": {"type": "string", "primary_key": true},
        "tenant_id": {"type": "string", "required": true, "foreign_key": "tenants._id"},
        "user_id": {"type": "string", "foreign_key": "users._id"},
        "session_id": {"type": "string", "description": "User session identifier"},
        "action": {"type": "enum", "values": ["create", "read", "update", "delete", "login", "logout", "export", "import", "approve", "reject"], "required": true},
        "resource_type": {"type": "string", "required": true, "description": "Type of resource affected"},
        "resource_id": {"type": "string", "required": true, "description": "ID of the affected resource"},
        "resource_name": {"type": "string", "description": "Name/title of the resource"},
        "old_values": {"type": "object", "description": "Previous values for updates"},
        "new_values": {"type": "object", "description": "New values for updates/creates"},
        "changed_fields": {"type": "array", "items": {"type": "string"}},
        "ip_address": {"type": "string"},
        "user_agent": {"type": "string"},
        "request_method": {"type": "string", "description": "HTTP method"},
        "request_url": {"type": "string"},
        "response_status": {"type": "integer"},
        "processing_time_ms": {"type": "integer"},
        "risk_level": {"type": "enum", "values": ["low", "medium", "high", "critical"], "default": "low"},
        "success": {"type": "boolean", "default": true},
        "error_message": {"type": "string"},
        "additional_data": {"type": "object"},
        "timestamp": {"type": "datetime", "required": true}
      },
      "indexes": [
        {"fields": ["tenant_id", "timestamp"]},
        {"fields": ["tenant_id", "user_id", "timestamp"]},
        {"fields": ["tenant_id", "action"]},
        {"fields": ["tenant_id", "resource_type", "resource_id"]},
        {"fields": ["tenant_id", "risk_level"]},
        {"fields": ["ip_address"]},
        {"fields": ["timestamp"], "ttl": "2years"}
      ]
    }
  }
}